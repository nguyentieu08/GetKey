<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nguyễn Tiêu AI - Zero API Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0c0c0e; color: #e2e2e4; height: 100dvh; display: flex; flex-direction: column; margin: 0; }
        .chat-container { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem; }
        .bubble { max-width: 85%; padding: 1rem 1.25rem; border-radius: 1.25rem; font-size: 0.95rem; line-height: 1.6; position: relative; }
        .ai-bubble { background: #1a1a1d; border: 1px solid #2d2d30; align-self: flex-start; border-bottom-left-radius: 4px; }
        .user-bubble { background: linear-gradient(135deg, #4f46e5, #7c3aed); color: #fff; align-self: flex-end; border-bottom-right-radius: 4px; }
        .input-box { background: #0c0c0e; border-top: 1px solid #1f1f22; padding: 1.2rem; }
        .progress-container { display: none; position: fixed; top: 0; left: 0; right: 0; height: 4px; background: #1a1a1d; z-index: 100; }
        #progress-bar { height: 100%; background: #4f46e5; width: 0%; transition: width 0.3s; }
        .loading-text { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; color: #6366f1; font-weight: bold; }
        pre { background: #000; padding: 10px; border-radius: 8px; overflow-x: auto; margin: 10px 0; border: 1px solid #333; }
        code { font-family: monospace; color: #818cf8; }
    </style>
</head>
<body>

    <div id="loading-overlay" class="progress-container">
        <div id="progress-bar"></div>
    </div>

    <header class="p-4 border-b border-zinc-800 flex items-center justify-between sticky top-0 bg-[#0c0c0e]/80 backdrop-blur-md z-10">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-bolt text-white"></i>
            </div>
            <div>
                <h1 class="font-bold text-sm">Nguyễn Tiêu <span class="text-indigo-400">AI v5</span></h1>
                <div id="status" class="loading-text">Đang chuẩn bị bộ não...</div>
            </div>
        </div>
        <button onclick="location.reload()" class="text-zinc-500 hover:text-white"><i class="fa-solid fa-rotate-right"></i></button>
    </header>

    <main id="viewport" class="chat-container">
        <div id="hero" class="my-auto text-center px-6">
            <div class="w-20 h-20 bg-indigo-500/10 rounded-[2.5rem] flex items-center justify-center mx-auto mb-6 border border-indigo-500/20">
                <i class="fa-solid fa-microchip text-indigo-500 text-3xl"></i>
            </div>
            <h2 class="text-2xl font-bold mb-3">AI Cộng Đồng 100% Free</h2>
            <p class="text-zinc-500 text-sm max-w-xs mx-auto mb-8">
                Hệ thống không sử dụng API. Toàn bộ trí tuệ được tải trực tiếp vào máy bạn. Bảo mật - Riêng tư - Miễn phí.
            </p>
        </div>
        <div id="chat-list"></div>
    </main>

    <footer class="input-box">
        <div class="max-w-3xl mx-auto flex items-center gap-3 bg-[#1a1a1d] rounded-2xl p-2 border border-zinc-800">
            <input id="chat-input" type="text" placeholder="Hãy đợi AI tải xong bộ não..." class="flex-1 bg-transparent border-none outline-none px-4 text-sm" disabled>
            <button id="send-btn" class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white opacity-50 cursor-not-allowed" disabled>
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </div>
        <p class="text-[9px] text-center text-zinc-600 mt-4 font-bold uppercase tracking-[0.2em]">Hệ thống AI Độc Lập • Phát triển bởi Nguyễn Tiêu</p>
    </footer>

    <script type="module">
        // Chúng ta sử dụng Transformers.js - công nghệ chạy AI trực tiếp trên trình duyệt
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

        // Tối ưu cấu hình
        env.allowLocalModels = false;
        
        const status = document.getElementById('status');
        const progressOverlay = document.getElementById('loading-overlay');
        const progressBar = document.getElementById('progress-bar');
        const input = document.getElementById('chat-input');
        const btn = document.getElementById('send-btn');
        const list = document.getElementById('chat-list');
        const viewport = document.getElementById('viewport');
        const hero = document.getElementById('hero');

        let generator;

        // Tải mô hình AI
        async function loadModel() {
            progressOverlay.style.display = 'block';
            try {
                // Sử dụng mô hình Flan-T5 hoặc tương đương (Rất nhẹ, chỉ ~100MB nhưng hiểu tiếng Việt cơ bản)
                generator = await pipeline('text2text-generation', 'Xenova/flan-t5-small', {
                    progress_callback: (p) => {
                        const percent = Math.round(p.progress || 0);
                        progressBar.style.width = percent + '%';
                        status.innerText = `Đang tải bộ não: ${percent}%`;
                    }
                });

                status.innerText = "Hệ thống đã sẵn sàng";
                status.classList.replace('text-zinc-500', 'text-green-500');
                input.disabled = false;
                input.placeholder = "Hỏi AI của bạn bất cứ điều gì...";
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                progressOverlay.style.display = 'none';
            } catch (err) {
                status.innerText = "Lỗi tải bộ não. Hãy tải lại trang!";
                console.error(err);
            }
        }

        loadModel();

        async function handleChat() {
            const prompt = input.value.trim();
            if (!prompt || !generator) return;

            hero.style.display = 'none';
            addBubble('user', prompt);
            input.value = '';
            
            const aiId = 'ai-' + Date.now();
            addBubble('ai', 'Đang suy nghĩ...', aiId);
            scroll();

            try {
                // AI xử lý trực tiếp trên máy bạn
                const output = await generator(prompt, {
                    max_new_tokens: 200,
                    temperature: 0.7,
                });

                const response = output[0].generated_text;
                document.getElementById(aiId).innerText = response || "Tôi đang học thêm, hãy hỏi câu khác nhé!";
            } catch (err) {
                document.getElementById(aiId).innerText = "Lỗi xử lý nội bộ.";
            }
            scroll();
        }

        function addBubble(role, content, id = '') {
            const div = document.createElement('div');
            div.className = `bubble ${role === 'user' ? 'user-bubble' : 'ai-bubble'} mb-4`;
            if (id) div.id = id;
            div.innerText = content;
            list.appendChild(div);
        }

        function scroll() { viewport.scrollTop = viewport.scrollHeight; }

        btn.onclick = handleChat;
        input.onkeydown = (e) => { if (e.key === 'Enter') handleChat(); };
    </script>
</body>
</html>

